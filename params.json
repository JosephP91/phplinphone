{"name":"Phplinphone","tagline":"C++ linphone library implementation, callable from PHP","body":"# phplinphone\r\n\r\nphplinphone is a C++ liblinphone library implementation, callable from PHP. Liblinphone is a high level library integrating all the SIP video calls feature into a single easy to use API. \r\n\r\nIf you want to know a bit more about linphone and liblinphone, you can visit linphone website: http://www.linphone.org/\r\n\r\nRequirements\r\n------------\r\n\r\nFirst of all, phpcpp and phplinphone requires C++11, so upgrade your compiler if you are using an older version.\r\n\r\nphplinphone, of course, need liblinphone to be installed, so you should install the latest version of liblinphone (at the time I'm writing, it's the 3.8.2), downloadable from here: http://mirror.lihnidos.org/GNU/savannah/linphone/3.8.x/sources/\r\n\r\nTo install liblinphone, you can follow this guide http://sagar.se/linphone-3.7.0-wheezy.html . It works for liblinphone 3.7.0, but you can easly modify it for 3.8.2 version.\r\n\r\nAfter you have installed liblinphone, you have to install phpcpp. phpcpp is a C++ library used to write PHP extension using C++ as main language. You can easly install it following phpcpp's website guide: http://www.php-cpp.com/documentation/install\r\n\r\nInstall\r\n-------\r\n\r\nOnce you have installed the required libraries and downloaded phplinphone sources, you can install phplinphone library simply typing:\r\n\r\n```bash\r\nmake && sudo make install && sudo php5enmod phplinphone\r\n```\r\n\r\nIf everything works without errors, you can begin to use phplinphone classes from your PHP code.\r\n\r\nSimple Usage\r\n------------\r\n\r\nLinphone can log its actions, so let's create a simple log from our PHP application:\r\n\r\n```php\r\n$log = new PhpLinphoneLog();\r\n$log->set('/path/to/my/log');\r\n```\r\n\r\nLinphone can also configure itself starting from a factory configuration path. If you know what it is, how it is builded, and if you have one, you can specify it in this way:\r\n\r\n```php\r\n$factoryConfig= new PhpLinphoneFactoryConfig();\r\n$factoryConfig->set('/path/to/my/factory/config');\r\n```\r\n\r\nIf you do not have a configuration file, don't panic. You can specifiy a file where liblinphone will write your settings.\r\n\r\n```php\r\n$config= new PhpLinphoneConfig();\r\n$config->set('/path/to/my/future/config');\r\n```\r\n\r\nNow we need to instantiate the main linphone object, which is the core object. Nothing easier than:\r\n\r\n```php\r\n$core = new PhpLinphoneCore();\r\n```\r\n\r\nIf you have created configuration files (as I showed in the previous code snippet) you can pass them to the core object, allowing it to use them.\r\n\r\n```php\r\n// If you have both of them\r\n$core = new PhpLinphoneCore($factoryConfig,$config);\r\n// If you have only the factory config\r\n$core = new PhpLinphoneCore($factoryConfig);\r\n// If you have only the config\r\n$core = new PhpLinphoneCore(NULL,$config);\r\n```\r\n\r\nNow we have the logs and core object. What now? We must provide our SIP account authentication credentials. I have created a SIP account on linphone website, so you can do like me and get your account for free: https://www.linphone.org/free-sip-service.html\r\nOnce you have registered your account, open back your beautiful terminal and keep writing:\r\n\r\n```php\r\n// We must provide our core object.\r\n$auth = new PhpLinphoneAuth($core);\r\n$auth->setUsername('sip:myusername@sip.linphone.org');\r\n$auth->setPassword('myverycomplexpassword');\r\n$auth->build();\r\n```\r\n\r\nLinphone authenticate you throught proxies, so let's create one and authenticate on it with:\r\n\r\n```php\r\n// We must provide core object and authentication object.\r\n$proxy = new PhpLinphoneProxy($core,$auth);\r\n$proxy->configure();\r\necho \"Registration in progres...\";\r\n$proxy->authenticate();\r\nif ($proxy->hasError()) {\r\n  echo \"failed with reason: \".$proxy->getError().\"\\n\";\r\n  exit;\r\n}\r\necho \"done.\\nNow disabling and clearing the proxy config... \";\r\n$proxy->disable();\r\n$proxy->clear();\r\nif ($proxy->isClear()) {\r\n  echo \"cleared.\\n\";\r\n} else {\r\n  echo \"could not be cleared.\\n\";\r\n}\r\n```\r\n\r\nNow we can begin to call our SIP friends!\r\n\r\n```php\r\n// Our buddie\r\n$userToCall = 'sip:myfriend@sip.linphone.org';\r\n// Let's create a call object.\r\n$call = new PhpLinphoneCall($core);\r\n/* We can also set a ring timeout, but it's not mandatory.*/\r\n$call->setRingTimeout(10);\r\n/* And you can even specify a call timeout. The difference between call timeout and ring timeout is that a ring\r\ntimeout is the number of seconds from when you begin to call until the user picks up the call. The call timeout,\r\ninstead, is the time from when the user picks up until he do something like press a key. Use the call timeout only if you want that the user press a number or something like that. */\r\n$call->setCallTimeout(10);\r\n$call->invite($userToCall);\r\n$call->start();\r\nwhile (!$call->isEnded() and !$call->hasError() and !$call->isReleased() and !$call->isRingExpired() and !$call->isCallExpired()) {\r\n      // Don't forget to call this method!! It must be called periodically to allow linphone core to do background work!\r\n      $core->iterate();\r\n}\r\necho \"User \".$call->getUser().\" ended the call!\\n\";\r\n$call->hangup();\r\nexit;\r\n```\r\n\r\n","google":"UA-64151023-1","note":"Don't delete this file! It's used internally to help with page regeneration."}